<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="/img/favicon.ico">
	<title>MEA Student Showcase</title>

	<link rel="stylesheet" type="text/css" href="main.css">
	<style type="text/css">
		body { color: white; }
		#features .feature div.info { 
			border-width: 0.5em; 
			border-color: white;
			bottom: 1em;
			right: 1em;
		}
	</style>
</head>
<body class="slideshow">
	<button id="start">Start Slideshow</button>

	<div id="features"></div>

	<script>

		function el(c, text) {
			const el = document.createElement('div');
			el.classList.add(c);
			if (text) el.textContent = text;
			return el;
		}

		function slides(json) {
			console.log(json);

			json.files.forEach(file => {
				const featureDiv = el('feature'),
					infoDiv = el('info'),
					titleDiv = el('title', file.title),
					studentsDiv = el('students', file.students.join(', ')),
					majorDiv = el('major', file.major),
					courseDiv = el('course', file.course);
				
				featureDiv.appendChild(infoDiv);
				infoDiv.appendChild(titleDiv);
				infoDiv.appendChild(studentsDiv);
				infoDiv.appendChild(majorDiv);
				infoDiv.appendChild(courseDiv);

				const media = file.type == 'image' ? new Image() : document.createElement('video');
				media.src = `/media/${file.src}`;
				const mediaDiv = el(file.type);
				mediaDiv.appendChild(media);
				featureDiv.appendChild(mediaDiv);
				document.getElementById('features').appendChild(featureDiv);
			});

			init();
		}

		function init() {
			const features = document.getElementsByClassName('feature');
			let count = 0;
			function nextFeature() {
				features[count].style.opacity = 0;
				if (count < features.length - 1) {
					count ++;
				} else {
					count = 0;
				}
				features[count].style.opacity = 1;
				if (features[count].children[1].classList.contains('video')) {
					features[count].children[1].children[0].play();
					features[count].children[1].children[0].addEventListener('ended', () => {
						nextFeature();
					});
				} else {
					setTimeout(nextFeature, 5000);
				}
			}

			console.log(features);

			document.getElementById('start').addEventListener('click', ev => {
				ev.currentTarget.style.display = 'none';
				if (features[count].children[1].classList.contains('video')) {
					features[count].children[1].children[0].play();
					features[count].children[1].children[0].addEventListener('ended', () => {
						nextFeature();
					});
				} else {
					setTimeout(nextFeature, 5000);
				}
			});
		}

		fetch('files.json')
			.then(response => { return response.json(); })
			.then(slides)
			.catch(error => { console.log('error', error); });
	</script>
</body>
</html>